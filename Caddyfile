:{$PORT} {
    log {
        output stdout
    }

    # Health check endpoint
    handle /health {
        respond "Caddy says hi!" 200
    }
    
    # Set the PostgREST URL from the environment variable with proper configuration
    reverse_proxy {$POSTGREST_URL} {
        timeout 30s
        header_up Host {upstream_hostport}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}